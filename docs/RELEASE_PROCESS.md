# リリース手順 (Release process)

この文書は `masakinihirota` プロジェクトにおける、タグとバージョン付けの正式な手順を示します。

目的: リリースに紐づくタグは `main` ブランチ上の確定されたコミットを指すようにし、`dev` ブランチ上にタグを残さないこと。

基本方針
- タグは注釈付きタグ（annotated tag, `-a`）で作成する。可能なら GPG 署名（`-s`）を付ける。
- バージョン番号の更新（package.json）を含むコミットにタグを付けるか、`main` にマージしたコミットをタグにする。
- 共有されたリモート上でのタグ書き換えは避ける（どうしても必要な場合はチーム全員に通知する）。

手順（手動）
1. まず `main` を最新にする

```powershell
git checkout main
git pull origin main
```

2. （開発が `dev` にある場合）`dev` を `main` にマージしてリリース対象の確定コミットを作る。必要に応じて PR ワークフローを踏む。

```powershell
git checkout main
git merge --no-ff dev -m "chore(release): merge dev for vX.Y.Z"
```

3. package.json の version を更新し、コミットする（手動）

```powershell
# あるいは pnpm/npm の version を使って自動化
git add package.json
git commit -m "chore(release): bump version to vX.Y.Z"
```

4. 注釈付きタグを作る

```powershell
git tag -a vX.Y.Z -m "release vX.Y.Z"
```

5. リモートに push

```powershell
git push origin main
git push origin vX.Y.Z
```

既にタグを `dev` で作ってしまった場合（対処）
1. ローカルのタグを削除

```powershell
git tag -d vX.Y.Z
```

2. リモートのタグを削除

```powershell
git push --delete origin vX.Y.Z
```

3. `main` にタグを作り直し、push

```powershell
git checkout main
git pull origin main
git tag -a vX.Y.Z -m "release vX.Y.Z"
git push origin vX.Y.Z
```

自動化（pnpm / npm）
```powershell
pnpm version patch -m "chore(release): %s"
git push origin main
git push --tags
```

CI 連携
- タグ push をトリガーにしてビルド／デプロイや GitHub Release 作成を行うと安全で自動化が進みます。
- `semantic-release` や `standard-version` を導入すると CHANGELOG の自動生成や公開処理を自動化できます。

注意事項
- リモートに push されたタグの上書き（強制更新）はチームでの混乱を招く可能性があるため、極力行わないこと。どうしても必要な場合は、事前にチームに周知してから行うこと。

---
Generated by automation to formalize the tagging process.
