---
description: 現状把握
agent: agent
tools:
  [
    "changes",
    "chrome-devtools/*",
    "context7/*",
    "edit",
    "extensions",
    "fetch",
    "githubRepo",
    "new",
    "next-devtools/*",
    "openSimpleBrowser",
    "Postgres(LOCAL-supabase)/*",
    "problems",
    "runCommands",
    "runNotebooks",
    "runSubagent",
    "runTasks",
    "search",
    "sequentialthinking/*",
    "serena/*",
    "supabase/deploy_edge_function",
    "supabase/execute_sql",
    "supabase/generate_typescript_types",
    "supabase/get_edge_function",
    "supabase/list_tables",
    "supabase/search_docs",
    "testFailure",
    "todos",
    "unsplash/*",
    "usages",
    "vscodeAPI",
  ]
---

## 目的

このプロンプトは `masakinihirota` リポジトリ上で現在の状況を把握し、**要件定義書・実装計画書・タスクリスト・実装**の整合性を確認します。ズレを早期検出し、修正を支援します。

---

## チェック対象ファイル

| 種類                        | ファイルパス                                                                                            |
| --------------------------- | ------------------------------------------------------------------------------------------------------- |
| 実装計画書                  | `masakinihirota/implementation_plan.md`                                                                 |
| タスクリスト                | `masakinihirota/tasks.md`                                                                               |
| 全体要件定義書              | `vns-masakinihirota-design/0012 全体 -01要件定義書 -02設計書 -03テスト計画書/0001-01-全体要件定義書.md` |
| 設計リポジトリ タスクリスト | `vns-masakinihirota-design/0019 todoタスクリスト/todoタスクリスト（優先順）.md`                         |
| Serena メモリ               | Serena MCP から取得                                                                                     |

---

## 実行手順

### Step 1: Serena でプロジェクト分析

```
Serena MCP を使用して現在のプロジェクト状況を取得する
- アクティブプロジェクトの確認
- メモリ一覧の取得
- 最新の進捗メモを読む
```

### Step 2: ドキュメント間の整合性チェック

以下の観点で各ドキュメントを比較する：

| チェック項目       | 基準                                                                                      |
| ------------------ | ----------------------------------------------------------------------------------------- |
| フェーズ定義の一致 | `implementation_plan.md` と設計リポジトリタスクリストでフェーズ番号・内容が一致しているか |
| タスクの同期       | `tasks.md` の完了状況が設計リポジトリタスクリストに反映されているか                       |
| 優先順位の整合     | 実装計画の「次のアクション」と設計リポジトリの優先順が矛盾していないか                    |
| 技術スタックの一致 | 要件定義書と実装計画書で技術選定が一致しているか                                          |

### Step 3: 実装との整合性チェック

| チェック項目         | 確認方法                                                 |
| -------------------- | -------------------------------------------------------- |
| タスク完了の実装確認 | `tasks.md` で ✅ のタスクが実際にコードとして存在するか  |
| テストの存在確認     | TDD 方針に従い、完了タスクにテストファイルがあるか       |
| DB スキーマの反映    | 要件定義書のエンティティが `drizzle/schema` に存在するか |
| ルーティング構造     | 実装計画の URL 設計が `src/app/` 構造と一致するか        |

### Step 4: ズレの報告フォーマット

ズレを検出した場合、以下の形式で報告する：

```markdown
## 🔴 ズレ検出レポート

### [カテゴリ: ドキュメント間 / 実装との乖離]

**場所**: [ファイルパスまたはタスク ID]
**期待値**: [要件/計画での記載内容]
**現状**: [実際の状態]
**影響度**: [高/中/低]
**推奨アクション**: [修正提案]
```

### Step 5: 修正アクション

ズレの影響度に応じて対応：

| 影響度 | アクション                                     |
| ------ | ---------------------------------------------- |
| 高     | 即座に修正を提案し、ユーザーに確認を求める     |
| 中     | レポートに記載し、次回タスク開始前に対応       |
| 低     | メモとして記録、スプリント終了時にまとめて対応 |

---

## 出力

1. **整合性サマリー**: 全体の健全性を 🟢🟡🔴 で表示
2. **ズレ一覧**: 検出した問題の詳細
3. **推奨アクション**: 優先度順の修正タスク
4. **Serena メモリ更新**: 進捗をメモリに保存

---

## 定期実行の推奨タイミング

- タスク完了ごと（TDD サイクル終了時）
- スプリント開始前
- 大きな機能実装の前後
- 1 週間以上間が空いた作業再開時
