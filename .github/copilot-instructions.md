---
applyTo: "**"
---

# 生成 AI への 指示書 for `masakinihirota` プロジェクト

文書は必ず日本語を使用してください。

実装計画は
implementation_plan.md
に沿って実装をしていきます。

定期指令
Serena MCP で現在の実装状況を分析し、進捗を更新してください。

## プロジェクトの概要

このプロジェクトは、`masakinihirota` Web アプリケーションを開発するためのマルチリポジトリワークスペースです。
以下の関心ごとを分離したリポジトリで構成されます。

- **`masakinihirota`**: コアアプリケーションコード（実装およびテスト）、GitHub Copilot 用の指示書・プロンプト、ドキュメント
- **`vns-masakinihirota-design`**: 人間が作る設計書・構想・要件定義

# VNS masakinihirota MVP 実装計画書

## 1. プロジェクト概要

**VNS (Value Network Service) masakinihirota** の MVP (Minimum Viable Product) を構築します。
本プロジェクトは、価値観に基づくコミュニティ形成（組織・国家）を支援するプラットフォームです。
「全体要件定義書」に基づき、テスト駆動開発 (TDD) で実装を進めます。

## 2. 技術スタック (確定版)

- **Frontend/Framework**: Next.js 15.5.2 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS v4, Shadcn/UI
- **Database**: PostgreSQL (Supabase Local)
- **ORM**: Drizzle ORM
- **Auth**: Supabase Auth (Google OAuth)
- **Testing**: Vitest + React Testing Library (TDD)
- **Deployment**: Vercel (予定)

shell は Windows11 の powershell を利用します。

## 3. 開発方針

- **テスト駆動開発 (TDD)**: RED -> GREEN -> REFACTOR のサイクルを徹底する。
- **コロケーション (Co-location)**: 機能単位でファイル (コンポーネント, ロジック, テスト) をまとめる。
- **ディレクトリ構造**: `src/app/(順序-機能名)/` の形式を採用し、メニュー順序を反映させる。

# 開発人数

一人で開発しています。
開発での、CI は利用しません。
プルリクエストは不要です。

### 開発ルール追記: CI/PR による自動 DB 統合テストは行わない

このプロジェクトはローカル Supabase を利用するワークフローを前提としているため、DB に依存する統合テストは CI の自動実行（push/PR）で動かさない方針を採っています。

理由:

- ローカル環境での再現性を重視し、CI 環境下でのテストフレークやタイムアウトを避けるため
- 開発者の高速なフィードバックを優先するため

運用ルール:

1. DB 統合テストは必ずローカルで実行（`pnpm run test:integration` を利用）
2. CI で実行する必要がある場合は、ワークフローを自動実行にしない。手動トリガ（workflow_dispatch）でのみ実行。
3. PR に DB 統合テストを含めない。必要な検証はローカルで行った上で PR を出す。

これにより CI のクイックフィードバック（ユニット／UI テスト）を妨げず、DB 統合テストは状況に応じて手動・ローカルで実行する運用に集約します。

## 全体の把握

serena でスキャンしてください。
現在のプロジェクトを Serena MCP を利用して分析してください。

serena のメモリから、現状を抜き出し把握します。
タスクが終わるたびに serena に進捗状況を更新を行います。

# Plan モード

日本語で書いてください。

# 要件定義書、設計書を依頼するときの注意点

## 目的

機能単位の成果物を簡潔に依頼し、重複や不要情報を避けることを目的とします。

## 要件定義書を依頼するとき

- 依頼文で `[対象機能名]` を明示し、他機能を含めないことを伝えてください。
- 出力は `[対象機能名]` の要件のみをまとめ、全体要件定義書.md など既存文書の情報を再掲しないように依頼してください。
- 例: `[対象機能名]=アクセス権限管理` の場合は、アクセス権限管理に必要な要件のみに絞ることを明記します。

## 設計書を依頼するとき

- 要件定義書と同様に `[対象機能名]` を明示し、その機能の設計に限定するよう依頼してください。
- 設計書には既存のアーキテクチャや全体設計の再掲を含めず、対象機能の構造・入出力・処理手順のみを求めてください。
- 例: `[対象機能名]=アクセス権限管理` の場合、その機能のモジュール構成やデータフローだけを整理するよう指定します。

# 駆動テスト開発

コンポーネントのテストはコロケーションの考え方を導入する

- 各コンポーネントに対して、その近くにテストコードを配置します。
- これにより、コードとテストの関連性が明確になり、保守性が向上します。

システムに関するテストは専用のテストディレクトリにまとめる

- システム全体の振る舞いを検証するテストは、専用のテストディレクトリ（例: `tests/`）に配置します。
- これにより、システム全体のテストが一元管理され、実行しやすくなります。

# その他

GitHub Copilot の返信の最後に、なにか Tips や関連するアドバイスがありましたら教えて下さい。
