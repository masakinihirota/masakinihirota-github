# MVP タスク一覧（優先順位・分割）

以下は `implementation_plan.md` に基づいた、最初の MVP 実装の小さいタスク群です。各タスクは TDD サイクルで進行します。

## フェーズ 1 — コア MVP（優先）

### 1. 認証 (最優先)
- Task 1.1: サインイン用受け入れ基準を定義 ✅
- Task 1.2: Vitest テスト（ユニット / 認証 UI のレンダリング失敗テスト）を作成 ✅
- Task 1.3: Supabase Auth 接続の最小実装（ローカル .env チェック） ✅
- Task 1.4: e2e 簡易検証 (ローカルでの手動手順文書化) ✅

Note: 新規 `/home2` の左サイドメニューを shadcn スタイルで追加しました (src/app/home2)。
Note: 新しく `/home3` を追加 — 認証後トップページ（route.json 未使用、shadcn スタイル）を `src/app/home3` に実装しました。

-### 2. プロフィール (高優先)
- Task 2.1: プロフィール表示・編集の受け入れ基準を決める ✅
- Task 2.2: コンポーネント単位のユニットテストを書く（profile view/edit） ✅
- Task 2.3: 最小実装: DB スキーマ（Drizzle）と API/ルート ✅

### 3. コミュニティ作成・一覧表示 (高)
- Task 3.1: コミュニティ作成フローの acceptance criteria 作成
 - Task 3.1: コミュニティ作成フローの acceptance criteria 作成 ✅
- Task 3.2: コンポーネントテスト (フォーム検証 / 作成成功失敗) を作る
- Task 3.3: 実装（小さな CRUD API + DB スキーマ）

## フェーズ 2 — ポイント経済（次フェーズ）
- Task 4.1: ポイント履歴表示の受け入れ基準
- Task 4.2: トランザクション表現と DB 制約（Drizzle migration）を設計
- Task 4.3: 最小限の支払い／付与フローのユニットテスト

## フェーズ 3 — 管理者機能等
- Task 5.1: RBAC の段階的導入プラン
	- Task 5.1.1: resource-scoped exception の扱いを修正し、グローバルな権限に誤適用されないようにする（ユニットテスト追加） ✅
- Task 5.2: 管理 UI のスケルトン作成

## TDD 連続実行ガイド — リストが完了するまで厳密に回す (必読)

このリポジトリでは、以下のルールにしたがって `mvp_tasks.md` の各タスクを **TDD（RED→GREEN→REFACTOR）で順番に完了** していきます。各サイクルは小さく、可視性が高いことを重視します。エージェント（自動実行／人手どちらでも）や開発者は本ガイドを必ず守ってください。

- 最重要ルール（必須）
	- 1 サイクルにつき **必ず 1 個だけ失敗するテスト（RED）を追加** してください。複数の失敗を一度に追加することは禁止です。
	- RED → 実装（GREEN）→ リファクタ（REFACTOR）の順を厳守してください。

- 実行フロー（手順）
	1. `mvp_tasks.md` で未完了（チェック無し）の **最上位のタスク** を選ぶ。
	2. 最小の失敗テストを 1 件だけ追加する（例: `src/.../<Target>.test.ts`）。
	3. テストを実行し、追加したテストが **確実に失敗すること** を確認する（RED）。
	4. 最小の実装を行ってテストをパスさせる（GREEN）。
	5. リファクタリングしてテストが全て通ることを確認する（REFACTOR）。
	6. `mvp_tasks.md` の該当タスクにチェックを入れ、作業ログ（`serena/*`）と最小のコミットメッセージを記録する。
	7. 次の未完了タスクへ移り、同じサイクルを繰り返す。完了するまで続行する。

- 自動チェック（CI / ローカル補助）
	- 新規に追加されたテストファイルについて、自動で **"新規失敗テスト数 === 1"** を検証するためのスクリプトがあります: `scripts/check-new-tests.js` (`pnpm check:new-tests`)。
	- CI や開発フローではこのスクリプトを実行し、条件を満たさない場合は失敗させて作業をブロックしてください（ただしローカル開発中は時間／環境に応じて運用を柔軟に）。

- Integration / DB テストの扱い
	- DB に依存する integration テストは `tests/integration/**` に分離して下さい。
	- integration テストは `RUN_DB_TESTS=1` が設定されている環境でのみ実行されます（ローカルで意図的に実行するか、CI で手動トリガに限定）。自動チェックは integration テストをスキップするように設定されていることを前提としてください。

- コミット / ドキュメントルール
	- 完了コミットにはテンプレートを使う: `TDD: complete <mvp_tasks.md#TaskIdentifier> — <short-description>`。
	- タスク完了時は `mvp_tasks.md` にチェックを入れ、その変更を同コミットに含めてください。

---

このガイドに従い、`mvp_tasks.md` のタスクが全てチェックされるまで、連続して TDD サイクルを実行してください。エージェントは各サイクルで `pnpm check:new-tests` を内部的に実行して自動判定することを推奨します。

